<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>Prime Judge â€” å¥‡æ•°ç´ æ•°ãƒãƒ£ãƒ¬ãƒ³ã‚¸</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      font-family: "Segoe UI", sans-serif;
      text-align: center;
      background: #f4f6f8;
      margin: 0;
      padding: 40px;
    }
    #container {
      background: #fff;
      border-radius: 10px;
      display: inline-block;
      padding: 40px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }
    h1 { margin-bottom: 24px; }
    #question {
      font-size: 32px;
      margin-bottom: 20px;
      font-weight: bold;
    }
    button {
      margin: 12px;
      padding: 14px 30px;
      font-size: 20px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      color: white;
    }
    #primeBtn { background: #4caf50; }
    #notPrimeBtn { background: #f44336; }
    #result {
      font-size: 26px;
      margin-top: 24px;
      height: 40px;
    }
  </style>
</head>
<body>
  <div id="container">
    <h1>Prime Judge â€” å¥‡æ•°ç´ æ•°ãƒãƒ£ãƒ¬ãƒ³ã‚¸</h1>
    <div id="question">ãƒ­ãƒ¼ãƒ‰ä¸­...</div>
    <button id="primeBtn" onclick="answer(true)">ç´ æ•°</button>
    <button id="notPrimeBtn" onclick="answer(false)">ç´ æ•°ã§ãªã„</button>
    <div id="result"></div>
  </div>

  <script>
    // â˜… ã‚ãªãŸã®GASãƒ‡ãƒ—ãƒ­ã‚¤URL
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyfkruRGvdx5d9UGjRdIktS_H6JCGLjNxVlKdQ6FJZ0euIuFNjCw3uNy6QbHm-Asn_Ajw/exec";

    const TOTAL_QUESTIONS = 10;
    const FEEDBACK_MS = 700; // æ­£è§£è¡¨ç¤ºã®å¾…ã¡æ™‚é–“ï¼ˆmsï¼‰

    let currentQuestion = 0;
    let correctCount = 0;
    let currentNumber = 0;
    const results = [];

    // --- ç´ æ•°åˆ¤å®šï¼ˆå¶æ•°ã‚¹ã‚­ãƒƒãƒ—ï¼‰ ---
    function isPrime(num) {
      if (num < 2) return false;
      if (num % 2 === 0) return false;
      const limit = Math.floor(Math.sqrt(num));
      for (let i = 3; i <= limit; i += 2) {
        if (num % i === 0) return false;
      }
      return true;
    }

    // --- 4ã€œ6æ¡ã®å¥‡æ•°ã‚’ç”Ÿæˆ ---
    function generateOddNumber() {
      const digits = Math.floor(Math.random() * 3) + 4;
      const min = Math.pow(10, digits - 1);
      const max = Math.pow(10, digits) - 1;
      let n;
      do {
        n = Math.floor(Math.random() * (max - min + 1)) + min;
      } while (n % 2 === 0); // å¶æ•°ã¯é™¤å¤–
      return n;
    }

    // --- å•é¡Œå‡ºé¡Œ ---
    function nextQuestion() {
      if (currentQuestion >= TOTAL_QUESTIONS) {
        showFinal();
        return;
      }
      currentNumber = generateOddNumber();
      document.getElementById("question").textContent = `${currentQuestion + 1}å•ç›®ï¼š${currentNumber} ã¯ç´ æ•°ï¼Ÿ`;
      document.getElementById("result").textContent = "";
    }

    // --- å›ç­”å‡¦ç† ---
    function answer(choice) {
      const primeBtn = document.getElementById("primeBtn");
      const notPrimeBtn = document.getElementById("notPrimeBtn");
      primeBtn.disabled = true;
      notPrimeBtn.disabled = true;

      const correct = isPrime(currentNumber);
      const isCorrect = (choice === correct);
      if (isCorrect) correctCount++;

      document.getElementById("result").textContent = isCorrect ? "â­• æ­£è§£ï¼" : "âŒ ä¸æ­£è§£";

      results.push({
        question: currentNumber,
        correctAnswer: correct ? "ç´ æ•°" : "ç´ æ•°ã§ãªã„",
        yourAnswer: choice ? "ç´ æ•°" : "ç´ æ•°ã§ãªã„",
        result: isCorrect ? "æ­£è§£" : "ä¸æ­£è§£",
        timestamp: new Date().toISOString()
      });

      setTimeout(() => {
        currentQuestion++;
        primeBtn.disabled = false;
        notPrimeBtn.disabled = false;
        nextQuestion();
      }, FEEDBACK_MS);
    }

    // --- çµ‚äº†ç”»é¢ ---
    function showFinal() {
      document.getElementById("question").innerHTML =
        `ğŸ‰ çµæœç™ºè¡¨ ğŸ‰<br>${TOTAL_QUESTIONS}å•ä¸­ <b>${correctCount}</b> å•æ­£è§£ï¼`;
      document.getElementById("primeBtn").remove();
      document.getElementById("notPrimeBtn").remove();
      document.getElementById("result").textContent = "çµæœã‚’ãƒ¡ãƒ¼ãƒ«ã«é€ä¿¡ä¸­...";
      sendMailSummary();
    }

    // --- Gmailã«ã¾ã¨ã‚ã¦é€ä¿¡ ---
    function sendMailSummary() {
      fetch(SCRIPT_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ results: results })
      })
      .then(res => res.text())
      .then(txt => {
        document.getElementById("result").textContent = "ğŸ“© ãƒ¡ãƒ¼ãƒ«é€ä¿¡å®Œäº†ï¼";
        console.log("é€ä¿¡çµæœ:", txt);
      })
      .catch(err => {
        document.getElementById("result").textContent = "âš ï¸ ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸ";
        console.error("é€ä¿¡ã‚¨ãƒ©ãƒ¼:", err);
      });
    }

    // --- é–‹å§‹ ---
    nextQuestion();
  </script>
</body>
</html>
