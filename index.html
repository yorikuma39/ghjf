<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Prime Judge</title>
<style>
  body { font-family: Arial; text-align: center; margin-top: 40px; }
  button { font-size: 20px; padding: 10px 30px; margin: 20px; }
</style>
</head>
<body>

<h1>Prime Judge</h1>
<p id="question">準備中…</p>

<button onclick="answer(true)">素数！</button>
<button onclick="answer(false)">素数じゃない！</button>

<script>
const TOTAL = 10;
let current = 0;
let number = 0;
let results = [];

// 4〜6問は素数にする
let primesNeeded = Math.floor(Math.random() * 3) + 4; // 4〜6
let primesGenerated = 0;

function isPrime(n) {
    if (n < 2) return false;
    if (n % 2 === 0) return n === 2;
    let r = Math.floor(Math.sqrt(n));
    for (let i = 3; i <= r; i += 2) {
        if (n % i === 0) return false;
    }
    return true;
}

// 4〜6桁の奇数ランダム
function randomOddNumber() {
    while (true) {
        let n = Math.floor(Math.random() * 999000) + 1000;
        if (n % 2 === 1) return n; // 奇数だけ
    }
}

function newQuestion() {
    if (current >= TOTAL) return;

    let needPrime = (primesGenerated < primesNeeded);

    while (true) {
        let n = randomOddNumber();
        let p = isPrime(n);

        if (needPrime && p) {
            number = n;
            primesGenerated++;
            break;
        } else if (!needPrime) {
            number = n;
            break;
        }
    }

    document.getElementById("question").innerText =
        `Q${current + 1}: ${number} は素数？`;
}

function answer(userAnswer) {
    const correct = isPrime(number);

    results.push({
        index: current + 1,
        number: number,
        prime: correct,
        user: userAnswer,
        ok: correct === userAnswer
    });

    current++;

    if (current >= TOTAL) {
        finishGame();
    } else {
        newQuestion();
    }
}

function finishGame() {
    document.getElementById("question").innerText = "結果を送信中…";

    fetch("YOUR_GAS_WEBAPP_URL", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(results)
    })
    .then(res => res.json())
    .then(() => {
        document.getElementById("question").innerText = "送信完了！おつかれさま！";
    })
    .catch(() => {
        document.getElementById("question").innerText = "送信失敗…";
    });
}

newQuestion();
</script>

</body>
</html>
