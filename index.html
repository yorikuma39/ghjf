<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <title>Prime Judge â€” ç´ æ•°ãƒãƒ£ãƒ¬ãƒ³ã‚¸</title>
  <style>
    body { 
      font-family: sans-serif; 
      text-align: center; 
      margin-top: 100px;
      background-color: #f0f8ff;
    }
    h1 { color: #333; }
    #number { font-size: 48px; margin: 20px 0; font-weight: bold; }
    button {
      font-size: 20px;
      margin: 10px;
      padding: 10px 20px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      color: white;
    }
    #primeBtn { background-color: #4caf50; }
    #notPrimeBtn { background-color: #f44336; }
    #result { font-size: 24px; margin-top: 30px; }
  </style>
</head>
<body>
  <h1>ç´ æ•°ãƒãƒ£ãƒ¬ãƒ³ã‚¸ ğŸ”¢</h1>
  <div id="number">---</div>
  <button id="primeBtn">ç´ æ•°ï¼</button>
  <button id="notPrimeBtn">ç´ æ•°ã˜ã‚ƒãªã„ï¼</button>
  <div id="result"></div>

  <script>
    // ===== è¨­å®š =====
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxUpS53EDMrcrvh6kTjhMBsGj7FF5sCsgig22mI7VLB-KFv0CX53EvHf0ns2h_PUO77/exec"; 
    const totalQuestions = 10;
    const showDelay = 700; // æ­£èª¤è¡¨ç¤ºã®ã‚ã¨æ¬¡ã®å•é¡Œã«é€²ã‚€ã¾ã§ã®æ™‚é–“(ms)

    // ===== å¤‰æ•° =====
    let currentNumber;
    let questionCount = 0;
    let score = 0;
    const startTime = new Date();
    const resultLog = [];

    // ===== ç´ æ•°åˆ¤å®š =====
    function isPrime(num) {
      if (num < 2) return false;
      if (num % 2 === 0) return num === 2;
      const sqrt = Math.floor(Math.sqrt(num));
      for (let i = 3; i <= sqrt; i += 2) {
        if (num % i === 0) return false;
      }
      return true;
    }

    // ===== ãƒ©ãƒ³ãƒ€ãƒ ãª4ã€œ6æ¡ã®æ•°ã‚’ç”Ÿæˆ =====
    function getRandomNumber() {
      const digits = Math.floor(Math.random() * 3) + 4; // 4,5,6æ¡
      const min = Math.pow(10, digits - 1);
      const max = Math.pow(10, digits) - 1;
      return Math.floor(Math.random() * (max - min + 1)) + min;
    }

    // ===== å•é¡Œã‚’è¡¨ç¤º =====
    function showQuestion() {
      if (questionCount >= totalQuestions) {
        endGame();
        return;
      }
      currentNumber = getRandomNumber();
      document.getElementById("number").textContent = currentNumber;
      document.getElementById("result").textContent = "";
      questionCount++;
    }

    // ===== å›ç­”å‡¦ç† =====
    function answer(isPrimeAnswer) {
      const correct = isPrime(currentNumber) === isPrimeAnswer;
      if (correct) score++;

      document.getElementById("result").textContent = correct ? "âœ… æ­£è§£ï¼" : "âŒ ä¸æ­£è§£ï¼";

      resultLog.push({
        å•é¡Œç•ªå·: questionCount,
        å‡ºé¡Œæ•°å­—: currentNumber,
        å›ç­”: isPrimeAnswer ? "ç´ æ•°" : "ç´ æ•°ã˜ã‚ƒãªã„",
        åˆ¤å®š: correct ? "æ­£è§£" : "ä¸æ­£è§£"
      });

      setTimeout(showQuestion, showDelay);
    }

    // ===== çµ‚äº†å‡¦ç† =====
    function endGame() {
      const endTime = new Date();
      const timeTaken = ((endTime - startTime) / 1000).toFixed(1);
      const finalMsg = `çµ‚äº†ï¼ã‚ãªãŸã®ã‚¹ã‚³ã‚¢ã¯ ${score}/${totalQuestions} ç‚¹\nï¼ˆæ‰€è¦æ™‚é–“: ${timeTaken}ç§’ï¼‰`;
      document.getElementById("number").textContent = "";
      document.getElementById("result").textContent = finalMsg;

      // --- Gmailé€ä¿¡ç”¨ãƒ‡ãƒ¼ã‚¿ ---
      const sendData = {
        score: score,
        total: totalQuestions,
        time: timeTaken,
        details: resultLog
      };

      // --- ãƒ¡ãƒ¼ãƒ«é€ä¿¡ï¼ˆGASã¸POSTï¼‰ ---
      fetch(SCRIPT_URL, {
        method: "POST",
        body: JSON.stringify(sendData),
        headers: { "Content-Type": "application/json" }
      })
      .then(r => r.text())
      .then(msg => console.log("é€ä¿¡æˆåŠŸ:", msg))
      .catch(e => console.error("é€ä¿¡å¤±æ•—:", e));
    }

    // ===== ãƒœã‚¿ãƒ³è¨­å®š =====
    document.getElementById("primeBtn").addEventListener("click", () => answer(true));
    document.getElementById("notPrimeBtn").addEventListener("click", () => answer(false));

    // ===== ã‚²ãƒ¼ãƒ é–‹å§‹ =====
    showQuestion();
  </script>
</body>
</html>

